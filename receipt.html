<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Receipt Page</title>
        <link rel="stylesheet" href="/receipt.css" />
        <script>
            // Function to fetch invoice data by ID from parent page's URL
            async function fetchInvoiceData() {
                // Get the URL parameters from the parent page
                const urlParams = new URLSearchParams(
                    window.parent.location.search
                );
                const id = urlParams.get('id'); // Extract the 'id' parameter
                if (id) {
                    try {
                        // Fetch data from the API
                        const response = await fetch(
                            `http://localhost:3000/api/invoices/${id}`
                        );
                        if (response.ok) {
                            const invoiceData = await response.json();

                            // Update matching fields
                            document.getElementById('receiptNoi').innerText =
                                invoiceData.receiptNumber || 'N/A';
                            document.getElementById(
                                'totalAmount'
                            ).innerText = `${invoiceData.amount || 'N/A'} درهم`;
                            document.getElementById(
                                'vehicleNumberi'
                            ).innerText = invoiceData.vehicleNumber || 'N/A';
                            document.getElementById('userNamei').innerText =
                                invoiceData.userName || 'N/A';

                            // Format and display date and time
                            const formattedDateTime = new Date(
                                invoiceData.date_time
                            ).toLocaleString('en-GB', {
                                dateStyle: 'short',
                                timeStyle: 'short',
                                hour12: true,
                            });
                            document.getElementById('dateTime').innerText =
                                formattedDateTime;
                        } else {
                            console.warn('Invoice not found');
                        }
                    } catch (error) {
                        console.error('Error fetching invoice data:', error);
                    }
                } else {
                    console.warn('No invoice ID provided in the URL');
                }
            }

            // Call the function when the page loads
            window.onload = fetchInvoiceData;
        </script>
    </head>
    <body>
        <div class="receipt-container">
            <div class="header">
                <img src="/images/toplogo2.png" alt="Logo" class="logo" />
                <h2 class="arabic-heading">حكومة الشارقة</h2>
            </div>
            <div class="arabic-lines">
                <span class="arabic-line left">دائرة المالية المركزية</span>
                <span class="arabic-line right">هيئة الطرق والمواصلات</span>
            </div>
            <div class="arabic-lines">
                <span class="arabic-line left">نظام تحصيل</span>
                <span class="arabic-line right"
                    >نظام التعرفة المرورية للشاحنات</span
                >
            </div>
            <div class="arabic-lines">
                <span class="arabic-line right third">بوابة المدام</span>
            </div>
            <!-- New Centered Section -->
            <div class="centered-section">
                <p class="receipt-text">(Payment Receipt)</p>
                <p class="language-text">Tax Invoice / فاتورة ضريبية</p>
                <p class="centered-number">TRN: 100531353900003</p>
            </div>
            <!-- 10 Arabic Text Rows with Values -->
            <div class="arabic-values-section">
                <div class="arabic-value-row">
                    <span class="value"></span>
                    <span class="arabic-text">
                        التاريخ : 19-10-2024 الوقت : 04:15 ص</span
                    >
                </div>
                <div class="arabic-value-row">
                    <span class="value" id="receiptNoi">34060201245790877</span>
                    <span class="arabic-text"> :رقم الإيصال</span>
                </div>

                <div class="arabic-value-row">
                    <span class="value">رسوم عبور شاحنة</span>

                    <span class="arabic-text"> :نوع الخدمة </span>
                </div>
                <div class="arabic-value-row">
                    <span class="value"></span>
                    <span class="arabic-text"> :اسم المالك</span>
                </div>
                <div class="arabic-value-row">
                    <span class="value">OMN B M 2805</span>
                    <span class="arabic-text"> :رقم المركبة</span>
                </div>
                <div class="arabic-value-row">
                    <span class="value">42.50درهم</span>

                    <span class="arabic-text"> :إجمالي المبلغ</span>
                </div>
                <div class="arabic-value-row">
                    <span class="value"></span>
                    <span class="arabic-text"> :رسوم أخرى</span>
                </div>
                <div class="arabic-value-row">
                    <span class="value">10.00 درهم</span>
                    <span class="arabic-text">
                        :دعم الأبحاث العلمية في إمارة الشارقة</span
                    >
                </div>
                <div class="arabic-value-row">
                    <span class="value">10.00 درهم</span>
                    <span class="arabic-text">:رسوم خدمات تحصيل</span>
                </div>
                <div class="arabic-value-row">
                    <span class="value">0.50 درهم</span>
                    <span class="arabic-text">:رسوم ضريبة القيمة المضافة</span>
                </div>

                <div class="note-container">
                    <div class="row">
                        <span class="value">Gate2m</span>
                        <span class="arabic-text"> :اسم المستخدم</span>
                    </div>
                    <span class="note"
                        >ملاحظة: يرجى الاحتفاظ بإيصال تحصيل لدواعي أمنية</span
                    >
                </div>
            </div>
            <div class="qr-container">
                <img src="/images/qrcode2.png" alt="QR Code" class="qr-code" />
            </div>
        </div>
    </body>
</html>
